<script>
    document.addEventListener("DOMContentLoaded", function () {
        // 【关键修复】去掉外层的引号，直接让 Hugo 输出 JS 数组格式
        const quotes = {{ site.Data.quotes | jsonify | safeJS }};
        
        // 调试用：如果这一行在控制台输出的是 String 而不是 Array，说明还是错的
        console.log("Quotes type:", typeof quotes, quotes);

        const targetSelector = '.sidebar .subtitle, .site-description, .profile-description';
        const subtitleElement = document.querySelector(targetSelector);

        // 确保 quotes 是一个真正的数组
        if (Array.isArray(quotes) && quotes.length > 0 && subtitleElement) {
            let currentIndex = 0;

            // 强制初始化显示第一句完整的话
            subtitleElement.innerText = quotes[currentIndex];

            // 样式与交互
            subtitleElement.style.animation = "none"; 
            subtitleElement.style.whiteSpace = "normal"; 
            subtitleElement.style.cursor = "pointer";
            subtitleElement.style.userSelect = "none";
            subtitleElement.style.transition = "opacity 0.2s ease"; 

            subtitleElement.addEventListener('click', function () {
                subtitleElement.style.opacity = 0;
                setTimeout(() => {
                    // 索引加 1
                    currentIndex = (currentIndex + 1) % quotes.length;
                    // 替换为整行文本
                    subtitleElement.textContent = quotes[currentIndex];
                    subtitleElement.style.opacity = 1;
                }, 200);
            });
        }
    });
</script>

<style>
/* 针对侧边栏描述的强制不换行优化 */
.sidebar .subtitle, .site-description, .profile-description {
    white-space: nowrap !important;    /* 强制不换行 */
    overflow: hidden !important;       /* 超出部分隐藏 */
    text-overflow: ellipsis !important; /* 超出部分显示省略号 (...) */
    display: block !important;         /* 确保宽度限制生效 */
    max-width: 100%;                   /* 限制最大宽度为侧边栏宽度 */
}
</style>