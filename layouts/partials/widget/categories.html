{{- $context := . -}}
{{- if .Context -}}
    {{- $context = .Context -}}
{{- end -}}

{{- $categories := $context.Site.Taxonomies.categories -}}

{{- /* 1. è·å–å½“å‰é¡µé¢çš„æ°¸ä¹…é“¾æ¥ï¼Œç”¨äºåç»­æ¯”å¯¹ */ -}}
{{- $currentPermalink := $context.Permalink -}}

{{- if gt (len $categories) 0 -}}
<div class="widget widget--card widget--categories">
    <h2 class="widget-title section-title">
        {{ T "categories" | default "Categories" }}
    </h2>
    
    <div class="widget-body">
        <div class="tagCloud-tags">
            {{ range $name, $taxonomy := $categories }}
                
                {{- /* é…ç½®åŒºåŸŸï¼šHSL è‰²ç›¸å­—å…¸ (0-360) */ -}}
                {{ $hueMap := dict 
                    "life"               351
                    "film & television"  45 
                    "coding"             170
                    "tech"               200
                    "design"             270
                    "reading"            100
                }}
                
                {{ $hue := index $hueMap $name | default 0 }}
                {{ $color := printf "hsl(%d, 60%%, 84%%)" $hue }}

                {{- /* 2. æ ¸å¿ƒé€»è¾‘ï¼šåˆ¤æ–­æ˜¯å¦å¤„äºå½“å‰åˆ†ç±»é¡µé¢ */ -}}
                {{- $isActive := eq $currentPermalink .Page.Permalink -}}

                <a href="{{ .Page.RelPermalink }}" 
                   class="category-link {{ if $isActive }}active{{ end }}"
                   style="
                       /* =========================================
                          ğŸ”´ å¸ƒå±€æ ¸å¿ƒè®¾ç½® (Fixed Width List)
                          ========================================= */
                       display: block;             /* è®©å®ƒæ˜¯å—çº§å…ƒç´ ï¼Œç‹¬å ä¸€è¡Œ */
                       width: 100%;            /* é˜²æ­¢å®½åº¦è¶…å‡ºçˆ¶å®¹å™¨ï¼ˆæ‰‹æœºç«¯å®‰å…¨æªæ–½ï¼‰*/
                       max-width: 240px;               /* ğŸ‘ˆã€å…³é”®ã€‘åœ¨è¿™é‡Œä¿®æ”¹ä½ çš„å›ºå®šå®½åº¦æ•°å€¼ */
                       
                       /* ä½ç½®æ§åˆ¶ï¼šå±…ä¸­è¿˜æ˜¯å±…å·¦ï¼Ÿé€‰ä¸€ä¸ª */
                       margin: 0 auto 10px auto;   /* æ–¹æ¡ˆA: å±…ä¸­å †å  (ä¸Šä¸‹10pxï¼Œå·¦å³è‡ªåŠ¨) */
                       /* margin: 0 0 10px 0; */   /* æ–¹æ¡ˆB: é å·¦å¯¹é½ */

                       text-align: center;         /* æ–‡å­—åœ¨æŒ‰é’®å†…éƒ¨å±…ä¸­ */
                       box-sizing: border-box;     /* ç¡®ä¿ padding ä¸ä¼šæ’‘å¤§å®½åº¦ */
                       
                       /* é•¿æ–‡å­—å¤„ç† (è¶…å‡ºæ˜¾ç¤ºçœç•¥å·) */
                       white-space: nowrap;
                       overflow: hidden;
                       text-overflow: ellipsis;
                       padding: 8px 10px;          /* å¢åŠ ä¸€ç‚¹å†…è¾¹è·ï¼Œè®©æŒ‰é’®èƒ–ä¸€ç‚¹æ›´å¥½çœ‹ */
                       border-radius: 8px;         /* åŠ ä¸Šåœ†è§’ */

                       {{ if $isActive }}
                           /* æ¿€æ´»çŠ¶æ€ */
                           background-color: {{ $color | safeCSS }} !important;
                           border: 1px solid {{ $color | safeCSS }} !important; 
                           color: #2a2a2a !important; 
                           box-shadow: 0 4px 15px {{ $color | safeCSS }}; /* å¢åŠ æŠ•å½±ç«‹ä½“æ„Ÿ */
                           transform: scale(1.05); /* æ¿€æ´»æ—¶ç¨å¾®å¤§ä¸€ç‚¹ç‚¹ */
                       {{ else }}
                           /* æ™®é€šçŠ¶æ€ */
                           background-color: transparent !important;
                           border: 1px solid {{ $color | safeCSS }} !important;
                           color: {{ $color | safeCSS }} !important;
                       {{ end }}
                       
                       /* åŠ ä¸Šè¿‡æ¸¡åŠ¨ç”»ï¼Œè®©é¼ æ ‡æ”¾ä¸Šå»å˜è‰²ä¸æ»‘ */
                       transition: all 0.3s ease; 
                   ">
                   {{ $name }} 
                   <span class="count-badge" style="
                        margin-left: 5px; 
                        font-size: 0.8em;
                        {{ if $isActive }}color: #2a2a2a !important; opacity: 0.8;{{ end }}
                   ">{{ .Count }}</span>
                </a>
            {{ end }}
        </div>
    </div>
</div>
{{- end -}}